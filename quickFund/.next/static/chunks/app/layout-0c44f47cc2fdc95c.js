(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{7283:(e,s,t)=>{"use strict";t.d(s,{O5:()=>u,Tp:()=>c,uE:()=>i});var r=t(22909);let a=()=>"/api/v1";class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}setToken(e){this.accessToken=e}getToken(){return this.accessToken}clearToken(){this.accessToken=null}constructor(){this.accessToken=null}}let o=n.getInstance(),i=(()=>{let e=r.A.create({baseURL:a(),timeout:1e4,headers:{"Content-Type":"application/json"},withCredentials:!0});return e.interceptors.request.use(e=>{let s=o.getToken();return s&&(e.headers.Authorization="Bearer ".concat(s)),e},e=>Promise.reject(e)),e.interceptors.response.use(e=>e,async s=>{var r;let a=s.config;if((null==(r=s.response)?void 0:r.status)===401&&!a._retry){a._retry=!0;try{let{authApi:s}=await Promise.resolve().then(t.bind(t,22370)),r=await s.refreshToken();return a.headers.Authorization="Bearer ".concat(r.accessToken),e(a)}catch(e){return o.clearToken(),sessionStorage.removeItem("quickfund-refresh-token"),Promise.reject(e)}}return Promise.reject(s)}),e})(),u=e=>{o.setToken(e)},c=()=>{o.clearToken()}},21868:(e,s,t)=>{"use strict";t.d(s,{default:()=>o});var r=t(95155),a=t(12115),n=t(83459);function o(e){let{children:s}=e,{initialize:t,isAuthenticated:o}=(0,n.nc)();return(0,a.useEffect)(()=>{(async()=>{try{await t()}catch(e){console.error("Auth initialization error:",e)}})()},[t]),(0,r.jsx)(r.Fragment,{children:s})}},22370:(e,s,t)=>{"use strict";t.d(s,{authApi:()=>i});var r=t(7283);let a=()=>sessionStorage.getItem("quickfund-refresh-token"),n=e=>{sessionStorage.setItem("quickfund-refresh-token",e)},o=()=>{sessionStorage.removeItem("quickfund-refresh-token")},i={login:async e=>{let s=await r.uE.post("/auth/login",e);return(0,r.O5)(s.data.accessToken),n(s.data.refreshToken),s.data},register:async e=>(await r.uE.post("/auth/register",e)).data,getProfile:async()=>(await r.uE.get("/auth/profile")).data.user,refreshToken:async e=>{let s=a();if(!s)throw Error("No refresh token available");let t=await r.uE.post("/auth/refresh",{refreshToken:s});return(0,r.O5)(t.data.accessToken),n(t.data.refreshToken),t.data},logout:async e=>{try{await r.uE.post("/auth/logout",{sessionId:e})}catch(e){console.warn("Logout request failed, but clearing local tokens:",e)}finally{(0,r.Tp)(),o()}},validateToken:async()=>{try{return await r.uE.get("/auth/profile"),!0}catch(e){return!1}},changePassword:async(e,s)=>{await r.uE.put("/auth/change-password",{currentPassword:e,newPassword:s})},forgotPassword:async e=>{await r.uE.post("/auth/forgot-password",{email:e})},resetPassword:async(e,s)=>{await r.uE.post("/auth/reset-password",{token:e,newPassword:s})}},{login:u,register:c,getProfile:l,refreshToken:d,logout:h,validateToken:g,changePassword:f,forgotPassword:k,resetPassword:p}=i},30347:()=>{},37265:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,30347,23)),Promise.resolve().then(t.bind(t,21868))},83459:(e,s,t)=>{"use strict";t.d(s,{nc:()=>l});var r=t(38942),a=t(95086),n=t(22370),o=t(7283),i=t(83827);let u=()=>sessionStorage.getItem("quickfund-refresh-token"),c=()=>{sessionStorage.removeItem("quickfund-refresh-token")},l=(0,r.v)()((0,a.Zr)((e,s)=>({user:null,isAuthenticated:!1,isLoading:!1,error:null,success:null,sessionId:null,setLoading:s=>e({isLoading:s}),clearError:()=>e({error:null}),clearSuccess:()=>e({success:null}),setUser:s=>e({user:s,isAuthenticated:!0,error:null}),login:async s=>{e({isLoading:!0,error:null,success:null});try{let t=await n.authApi.login(s),r=null;try{t.accessToken&&(r=(0,i.s)(t.accessToken).sessionId||void 0)}catch(e){console.warn("Failed to decode JWT for sessionId:",e)}e({user:t.user,isAuthenticated:!0,isLoading:!1,error:null,success:"Login successful! Welcome back.",sessionId:r})}catch(s){var t,r;throw e({isLoading:!1,error:(null==(r=s.response)||null==(t=r.data)?void 0:t.message)||"Login failed",success:null,sessionId:null}),s}},register:async s=>{e({isLoading:!0,error:null,success:null});try{await n.authApi.register(s),e({user:null,isAuthenticated:!1,isLoading:!1,error:null,success:"Account created successfully! Please sign in to continue."})}catch(s){var t,r;throw e({isLoading:!1,error:(null==(r=s.response)||null==(t=r.data)?void 0:t.message)||"Registration failed",success:null}),s}},logout:async()=>{e({isLoading:!0,error:null,success:null});let t=s().sessionId;try{await n.authApi.logout("string"==typeof t&&t?t:void 0)}catch(e){console.warn("Logout error:",e)}finally{(0,o.Tp)(),c(),e({user:null,isAuthenticated:!1,isLoading:!1,error:null,success:"Logged out successfully. Come back soon!",sessionId:null})}},getProfile:async()=>{e({isLoading:!0,error:null,success:null});try{let s=await n.authApi.getProfile();e({user:s,isAuthenticated:!0,isLoading:!1,error:null,success:null})}catch(r){var s,t;throw e({isLoading:!1,error:(null==(t=r.response)||null==(s=t.data)?void 0:s.message)||"Failed to get profile",success:null}),r}},initialize:async()=>{e({isLoading:!0});try{if(!u())return void e({user:null,isAuthenticated:!1,isLoading:!1,error:null,success:null});await n.authApi.refreshToken();let s=await n.authApi.getProfile();e({user:s,isAuthenticated:!0,isLoading:!1,error:null,success:null})}catch(s){console.warn("Session refresh failed or expired:",(null==s?void 0:s.message)||s),(0,o.Tp)(),c(),e({user:null,isAuthenticated:!1,isLoading:!1,error:null,success:null})}}}),{name:"quickfund-auth",storage:(0,a.KU)(()=>({getItem:e=>{try{return localStorage.getItem(e)}catch(e){return null}},setItem:(e,s)=>{try{localStorage.setItem(e,s)}catch(e){console.warn("Failed to persist auth state:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.warn("Failed to remove auth state:",e)}}})),partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated,error:e.error,success:e.success})}))}},e=>{var s=s=>e(e.s=s);e.O(0,[690,981,441,684,358],()=>s(37265)),_N_E=e.O()}]);